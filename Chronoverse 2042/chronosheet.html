<div>
  <!-- 
  <button class="hidden" name="roll_reroll0" type="roll" value="&amp;{template:tftl} {{name=Reroll}} {{character_name=@{character_name}}} {{reroll_dice=0}} {{roll=[[0d6&gt;6]]}}"></button>
  <button class="hidden" name="roll_reroll1" type="roll" value="&amp;{template:tftl} {{name=Reroll}} {{character_name=@{character_name}}} {{reroll_dice=1}} {{roll=[[1d6&gt;6]]}}"></button>
  <button class="hidden" name="roll_reroll2" type="roll" value="&amp;{template:tftl} {{name=Reroll}} {{character_name=@{character_name}}} {{reroll_dice=2}} {{roll=[[2d6&gt;6]]}}"></button>
  <button class="hidden" name="roll_reroll3" type="roll" value="&amp;{template:tftl} {{name=Reroll}} {{character_name=@{character_name}}} {{reroll_dice=3}} {{roll=[[3d6&gt;6]]}}"></button>
  <button class="hidden" name="roll_reroll4" type="roll" value="&amp;{template:tftl} {{name=Reroll}} {{character_name=@{character_name}}} {{reroll_dice=4}} {{roll=[[4d6&gt;6]]}}"></button>
  <button class="hidden" name="roll_reroll5" type="roll" value="&amp;{template:tftl} {{name=Reroll}} {{character_name=@{character_name}}} {{reroll_dice=5}} {{roll=[[5d6&gt;6]]}}"></button>
  <button class="hidden" name="roll_reroll6" type="roll" value="&amp;{template:tftl} {{name=Reroll}} {{character_name=@{character_name}}} {{reroll_dice=6}} {{roll=[[6d6&gt;6]]}}"></button>
  <button class="hidden" name="roll_reroll7" type="roll" value="&amp;{template:tftl} {{name=Reroll}} {{character_name=@{character_name}}} {{reroll_dice=7}} {{roll=[[7d6&gt;6]]}}"></button>
  <button class="hidden" name="roll_reroll8" type="roll" value="&amp;{template:tftl} {{name=Reroll}} {{character_name=@{character_name}}} {{reroll_dice=8}} {{roll=[[8d6&gt;6]]}}"></button>
  <button class="hidden" name="roll_reroll9" type="roll" value="&amp;{template:tftl} {{name=Reroll}} {{character_name=@{character_name}}} {{reroll_dice=9}} {{roll=[[9d6&gt;6]]}}"></button>
  <button class="hidden" name="roll_reroll10" type="roll" value="&amp;{template:tftl} {{name=Reroll}} {{character_name=@{character_name}}} {{reroll_dice=10}} {{roll=[[10d6&gt;6]]}}"></button>
  <button class="hidden" name="roll_reroll11" type="roll" value="&amp;{template:tftl} {{name=Reroll}} {{character_name=@{character_name}}} {{reroll_dice=11}} {{roll=[[11d6&gt;6]]}}"></button>
  <button class="hidden" name="roll_reroll12" type="roll" value="&amp;{template:tftl} {{name=Reroll}} {{character_name=@{character_name}}} {{reroll_dice=12}} {{roll=[[12d6&gt;6]]}}"></button>
  <button class="hidden" name="roll_reroll13" type="roll" value="&amp;{template:tftl} {{name=Reroll}} {{character_name=@{character_name}}} {{reroll_dice=13}} {{roll=[[13d6&gt;6]]}}"></button>
  <button class="hidden" name="roll_reroll14" type="roll" value="&amp;{template:tftl} {{name=Reroll}} {{character_name=@{character_name}}} {{reroll_dice=14}} {{roll=[[14d6&gt;6]]}}"></button>
  <button class="hidden" name="roll_reroll15" type="roll" value="&amp;{template:tftl} {{name=Reroll}} {{character_name=@{character_name}}} {{reroll_dice=15}} {{roll=[[15d6&gt;6]]}}"></button> -->
</div>
<button 
  name="roll_reroll_push" 
  type="roll" 
  value="&amp;{template:tftl} {{name=Push}} {{character_name=@{character_name}}} {{desire=@{desire}}} {{empathy=@{empathy}}} {{roll=[[[[@{desire}]]d6&gt;6]]}} {{energy=@{energy}}} {{energyMax=@{energy|max}}}">
</button>

<input data-i18n-value="Reroll" name="attr_spirit_button" type="hidden" value="Spirit Push"/>

<input name="attr_sheet_version" type="hidden"/>
<div class="tftl-wrapper">
  <div class="tftl-logo"><img src="https://i.imgur.com/hncOnkZ.jpg"/></div>
  <div class="tftl-leftcol">
    <div class="tftl-attributes tftl-panel--alternate">
      <div class="tftl-panel__header background-rand-2" data-i18n="Attributes">Attributes</div>
      <div class="tftl-panel__row background-rand-6">
        <button 
          class="tftl-panel__label--button" 
          xdata-i18n="Control" 
          type="roll" 
          value="&amp;{template:tftl} {{action_name=Control}} {{character_name=@{character_name}}} {{roll=[[[[@{control}+?{Bonus Dice|0}]]d6&gt;6]]}} {{spirit_button=[@{spirit_button}](~@{character_id}|reroll_push)}} {{stat_value=@{control}}} {{stat_title=Control}} {{bonus_dice=?{Bonus Dice|0}}} {{energy=@{energy}}} {{energyMax=@{energy|max}}}"> Control
        </button>
        <input class="tftl-panel__input--small" name="attr_control" type="number" value="0"/>
      </div> <!-- control button -->
      <div class="tftl-panel__row background-rand-6">
        <button 
          class="tftl-panel__label--button" 
          xdata-i18n="Flow" 
          type="roll" 
          value="&amp;{template:tftl} {{action_name=Flow}} {{character_name=@{character_name}}} {{roll=[[[[@{flow}+?{Bonus Dice|0}]]d6&gt;6]]}} {{stat_value=@{flow}}} {{stat_title=flow}} {{bonus_dice=?{Bonus Dice|0}}} "> Flow
        </button>
        <input class="tftl-panel__input--small" name="attr_flow" type="number" value="0"/>
      </div> <!-- flow button -->
      
      <div class="tftl-panel__row background-rand-6">
        <button 
          class="tftl-panel__label--button" 
          xdata-i18n="Think" 
          type="roll" 
          value="&amp;{template:tftl} {{action_name=Think}} {{character_name=@{character_name}}} {{roll=[[[[@{think}+?{Bonus Dice|0}]]d6&gt;6]]}} {{stat_value=@{think}}} {{stat_title=Think}} {{bonus_dice=?{Bonus Dice|0}}} "> Think
        </button>
        <input class="tftl-panel__input--small" name="attr_think" type="number" value="0"/>
      </div> <!-- think button -->
      
      <div class="tftl-panel__row background-rand-6">
        <button 
          class="tftl-panel__label--button" 
          xdata-i18n="Vibe" 
          type="roll" 
          value="&amp;{template:tftl} {{action_name=Vibe}} {{character_name=@{character_name}}} {{roll=[[[[@{vibe}+?{Bonus Dice|0}]]d6&gt;6]]}} {{stat_value=@{vibe}}} {{stat_title=Vibe}} {{bonus_dice=?{Bonus Dice|0}}} "> Vibe
        </button>
        <input class="tftl-panel__input--small" name="attr_vibe" type="number" value="0"/>
      </div> <!-- Vibe button -->

      <div class="tftl-panel__row background-rand-6">
        <button 
          class="tftl-panel__label--button" 
          xdata-i18n="Desire" 
          type="roll" 
          value="&amp;{template:tftl} {{action_name=Desire}} {{character_name=@{character_name}}} {{roll=[[[[@{desire}+?{Bonus Dice|0}]]d6&gt;6]]}} {{stat_value=@{desire}}} {{stat_title=desire}} {{bonus_dice=?{Bonus Dice|0}}} "> Desire
        </button>
        <input class="tftl-panel__input--small" name="attr_desire" type="number" value="0"/>
      </div> <!-- desire button -->

      <div class="tftl-panel__row background-rand-6">
        <button 
          class="tftl-panel__label--button" 
          xdata-i18n="Empathy" 
          type="roll" 
          value="&amp;{template:tftl} {{name=empathy}} {{character_name=@{character_name}}} {{roll=[[[[@{empathy}+?{Bonus Dice|0}]]d6&gt;6]]}} {{stat_value=@{empathy}}} {{stat_title=empathy}} {{bonus_dice=?{Bonus Dice|0}}} "> Empathy
        </button>
        <input class="tftl-panel__input--small" name="attr_empathy" type="number" value="0"/>
      </div> <!-- empathy button -->

    <div class="tftl-attributes tftl-panel--alternate">
      <div class="tftl-panel__header background-rand-2" xdata-i18n="Hitpoints">Hitpoint/Energy</div>

      <div class="tftl-panel__row background-rand-6">
        <strong 
          xdata-i18n="hitpoints"
          class="tftl-panel__label--button">Hitpoints
        </strong>
        <input class="tftl-panel__input--small" name="attr_hitpoint" xplaceholder="25" title="@{attr_hitpoint}" type="number">
        <span class="minmax-display-divide"> / </span>
        <input class="tftl-panel__input--small" name="attr_hitpoint_max" xplaceholder="25" title="@{attr_hitpoint_max}" type="number">
      </div>

      <div class="tftl-panel__row background-rand-9">
        <strong 
          xdata-i18n="energy"
          class="tftl-panel__label--button">Energy
        </strong>
        <input class="tftl-panel__input--small" name="attr_energy" xplaceholder="25" title="@{attr_energy}" type="number">
        <span class="minmax-display-divide">/  </span>
        <input class="tftl-panel__input--small" name="attr_energy_max" xplaceholder="25" title="@{attr_energy_max}" type="number">
      </div>
      <!-- 
      <div class="minmax-display">
        <div class="minmax-display-wrapper edit-show">
        </div> -->

        <!-- <div class="sheet-minmax-display-wrapper sheet-edit-show">
          <label data-i18n-title="current hitpoints input" title="current hitpoints input">
            <input class="sheet-npc-input-large" name="attr_hitpoints" xplaceholder="25" title="@{attr_hitpoints}" type="number">
          </label><span class="sheet-minmax-display-divide">/  </span>
          <label data-i18n-title="maximum hitpoints input" title="maximum hitpoints input">
            <input class="sheet-npc-input-large" name="attr_hitpoints_max" xplaceholder="25" title="@{attr_hitpoints_max}" type="number">
          </label>
        </div> -->
      </div> <!-- sheet-minmax-display -->
      <!--<div class="sheet-minmax-display-toggles sheet-checkmark">
        <label class="sheet-checkmark-item" data-i18n-title="major wound checkmark" title="major wound checkmark">
          <input name="attr_major_wound" title="@{attr_major_wound}" type="checkbox"><strong data-i18n="major wound">major wound</strong>
        </label>
        <label class="sheet-checkmark-item" data-i18n-title="unconscious checkmark" title="unconscious checkmark">
          <input name="attr_unconscious" title="@{attr_unconscious}" type="checkbox"><strong data-i18n="unconscious">unconscious</strong>
        </label>
        <label class="sheet-checkmark-item" data-i18n-title="dying checkmark" title="dying checkmark">
          <input name="attr_dying" title="@{attr_dying}" type="checkbox"><strong data-i18n="dying">dying</strong>
        </label>
      </div> <!-- sheet-minmax-display-toggles -->
    </div> <!-- sheet-attribute-display -->

    <!-- entry1 -->
    <div class="tftl-attributes tftl-panel--alternate">
      <div class="tftl-panel__header background-rand-10" xdata-i18n="Suffering">Suffering</div>
      <div class="tftl-panel__row tftl-experience background-rand-1"> 
        <label class="tftl-checkbox">
          <input class="tftl-checkbox__hide" name="attr_experience_1" type="checkbox"/><span class="tftl-checkbox__show"></span>
        </label>
        <label class="tftl-checkbox">
          <input class="tftl-checkbox__hide" name="attr_experience_2" type="checkbox"/><span class="tftl-checkbox__show"></span>
        </label>
        <label class="tftl-checkbox">
          <input class="tftl-checkbox__hide" name="attr_experience_3" type="checkbox"/><span class="tftl-checkbox__show"></span>
        </label>
        <label class="tftl-checkbox">
          <input class="tftl-checkbox__hide" name="attr_experience_4" type="checkbox"/><span class="tftl-checkbox__show"></span>
        </label>
        <label class="tftl-checkbox">
          <input class="tftl-checkbox__hide" name="attr_experience_5" type="checkbox"/><span class="tftl-checkbox__show"></span>
        </label>
        <label class="tftl-checkbox">
          <input class="tftl-checkbox__hide" name="attr_experience_6" type="checkbox"/><span class="tftl-checkbox__show"></span>
        </label>
        <label class="tftl-checkbox">
          <input class="tftl-checkbox__hide" name="attr_experience_7" type="checkbox"/><span class="tftl-checkbox__show"></span>
        </label>
        <label class="tftl-checkbox">
          <input class="tftl-checkbox__hide" name="attr_experience_8" type="checkbox"/><span class="tftl-checkbox__show"></span>
        </label>
        <label class="tftl-checkbox">
          <input class="tftl-checkbox__hide" name="attr_experience_9" type="checkbox"/><span class="tftl-checkbox__show"></span>
        </label>
        <label class="tftl-checkbox">
          <input class="tftl-checkbox__hide" name="attr_experience_10" type="checkbox"/><span class="tftl-checkbox__show"></span>
        </label>
      </div>
    </div> <!-- experience container  -->
  </div> <!-- tftl-leftcol -->
  <div class="tftl-rightcol">
    <div class="tftl-panel--full tftl-character">
      <div class="tftl-panel__row--span1 tftl-panel__row--name background-rand-10"><strong class="tftl-panel__label--small tftl-panel__label" data-i18n="Name">Name</strong>
        <input class="tftl-panel__input--hide" name="attr_character_name" type="text"/>
      </div>
      <div class="tftl-panel__row--span1 tftl-panel__row--type background-rand-3"><strong class="tftl-panel__label--small tftl-panel__label" xdata-i18n="Type">Politic</strong>
        <input class="tftl-panel__input--hide" name="attr_type" type="text"/>
      </div>
      <div class="tftl-panel__row--span1 tftl-panel__row--age background-rand-9">
        <strong class="tftl-panel__label--small tftl-panel__label" data-i18n="Age">Age</strong>
        <input class="tftl-panel__input--hide" name="attr_age" type="number"/>
      </div>
      
      <div class="tftl-panel__row--span1 tftl-panel__row--profession background-rand-4">
        <strong class="tftl-panel__label--small tftl-panel__label" xdata-i18n="Class">Class</strong>
        <input class="tftl-panel__input--hide" name="attr_class" type="text"/>
      </div>
      <!-- <div class="tftl-panel__row--span1 tftl-panel__row--luck background-rand-4">
        <strong class="tftl-panel__label--small tftl-panel__label" data-i18n="Luck">Luck</strong>
        <input class="tftl-panel__input--hide" name="attr_luck_max" type="number"/>
        <div class="tftl-checks">
          <label class="tftl-checkbox">
            <input class="tftl-checkbox__hide" name="attr_luck_1" type="checkbox"/><span class="tftl-checkbox__show"> </span>
          </label>
          <label class="tftl-checkbox">
            <input class="tftl-checkbox__hide" name="attr_luck_2" type="checkbox"/><span class="tftl-checkbox__show"> </span>
          </label>
          <label class="tftl-checkbox">
            <input class="tftl-checkbox__hide" name="attr_luck_3" type="checkbox"/><span class="tftl-checkbox__show"> </span>
          </label>
          <label class="tftl-checkbox">
            <input class="tftl-checkbox__hide" name="attr_luck_4" type="checkbox"/><span class="tftl-checkbox__show"> </span>
          </label>
          <label class="tftl-checkbox">
            <input class="tftl-checkbox__hide" name="attr_luck_5" type="checkbox"/><span class="tftl-checkbox__show"> </span>
          </label>
        </div>
      </div> -->
      <div class="tftl-panel__row--span2 tftl-panel__row--drive background-rand-10"><strong class="tftl-panel__label--small tftl-panel__label" data-i18n="Drive">Drive</strong>
        <input class="tftl-panel__input--hide" name="attr_drive" type="text"/>
      </div>
      <div class="tftl-panel__row--span2 tftl-panel__row--problem background-rand-1"><strong class="tftl-panel__label--small tftl-panel__label" data-i18n="Problem">Problem</strong>
        <input class="tftl-panel__input--hide" name="attr_problem" type="text"/>
      </div>
      <div class="tftl-panel__row--span2 tftl-panel__row--pride background-rand-2"><strong class="tftl-panel__label--small tftl-panel__label" data-i18n="Pride">Pride</strong>
        <input class="tftl-panel__input--hide" name="attr_pride" type="text"/>
        <label class="tftl-checkbox">
          <input class="tftl-checkbox__hide" name="attr_pride_check" type="checkbox" value="1"/><span class="tftl-checkbox__show"> </span>
        </label>
      </div>
      <div class="tftl-panel__row--span2 tftl-panel__row--description background-rand-3"><strong class="tftl-panel__label--small tftl-panel__label" data-i18n="Description">Description</strong>
        <input class="tftl-panel__input--hide" name="attr_description" type="text"/>
      </div>
      <div class="tftl-panel__row--span1 tftl-panel__row--favourite_song background-rand-5"><strong class="tftl-panel__label--small tftl-panel__label" data-i18n="Favourite Song">Favourite Song</strong>
        <input class="tftl-panel__input--hide" name="attr_favourite_song" type="text"/>
      </div>
      <div class="tftl-panel__row--span1 tftl-panel__row--anchor background-rand-10"><strong class="tftl-panel__label--small tftl-panel__label" data-i18n="Anchor">Anchor</strong>
        <input class="tftl-panel__input--hide" name="attr_anchor" type="text"/>
      </div>
    </div>
    <div class="tftl-panel--full">
      <div class="tftl-panel__header background-rand-5" data-i18n="Relationships">Relationships</div>
      <fieldset class="repeating_relationships">
        <div class="tftl-panel__row--relationship background-rand-5">
          <select class="tftl-panel__label--select" name="attr_relationship_type">
            <option data-i18n="PC">PC</option>
            <option data-i18n="NPC">NPC</option>
          </select>
          <input class="tftl-panel__input--hide" name="attr_relationship" type="text"/>
        </div>
      </fieldset>
    </div>
    <div class="tftl-panel">
      <div class="tftl-panel__header background-rand-9"><span class="tftl-panel__left" data-i18n="Items">Items</span><span class="tftl-panel__right" data-i18n="Bonus">Bonus</span></div>
      <div class="tftl-panel__row--iconic background-rand-6"><span class="tftl-panel__label--small" data-i18n="Iconic Item">Iconic Item</span>
        <input class="tftl-panel__input--hide" name="attr_iconic_item" type="text"/><span class="tftl-panel__label--value">+2</span>
      </div>
      <fieldset class="repeating_item">
        <div class="tftl-panel__row--item background-rand-3">
          <input class="tftl-panel__input--hide" name="attr_item_name" type="text"/><span class="tftl-panel__label--plus">+</span>
          <input class="tftl-panel__input--item" name="attr_item_bonus" type="number" value="0"/>
        </div>
      </fieldset>
    </div>
    <div class="tftl-panel--fullheight">
      <div class="tftl-panel__header background-rand-1" data-i18n="Hideout">Hideout</div>
      <div class="tftl-panel__row--textarea background-rand-1">
        <textarea class="tftl-panel__textarea--full" name="attr_hideout"></textarea>
      </div>
    </div>
    <div class="tftl-panel--full">
      <div class="tftl-panel__header background-rand-9" data-i18n="Notes">Notes</div>
      <div class="tftl-panel__row--textarea background-rand-6">
        <textarea class="tftl-panel__textarea--full" name="attr_notes"></textarea>
      </div>
    </div>
  </div> <!-- tftl-rightcol -->
</div> <!-- tftl-wrapper -->
<rolltemplate class="sheet-rolltemplate-tftl">
  <div class="sheet-tftl-container">
    {{#action_name}}
      <h1>{{action_name}}</h1>
    {{/action_name}}

    {{#character_name}}
      <h2>{{character_name}} </h2>
    {{/character_name}}

    <div class="sheet-tftl-body">
      {{#stat_value}}
        <div class="sheet-tftl-roll-row"><span>+</span><span>{{stat_title}}</span><span>({{stat_value}})</span></div>
      {{/stat_value}}
      
      {{#skill_value}}
        <div class="sheet-tftl-roll-row"><span>+</span><span>{{skill_title}}</span><span>({{skill_value}})</span></div>
      {{/skill_value}}

      {{#bonus_dice}}
        <div class="sheet-tftl-roll-row">
          <span>+</span>
          <span data-i18n="Bonus">Bonus</span>
          <span>({{bonus_dice}}) </span>
        </div>
      {{/bonus_dice}}

      <div class="sheet-tftl-roll-row">
        <span xdata-i18n="Bonus">Energy</span>
        <span>({{energy}}) </span> / <span>({{energyMax}}) </span> 
      </div>
      
    </div>
    <div class="sheet-tftl-roll">
      <span>{{roll}}</span> <span>Successes</span>
    </div>

    <div class="sheet-tftl-buttons">
      {{spirit_button}}
      <div class="sheet-tftl-buttontext" 
        xdata-i18n="Push with your Spirit!">
        Push with your Spirit!
      </div>
    </div>

    <div class="sheet-tftl-footer"></div>

  </div> <!-- sheet-tftl-container -->
</rolltemplate>

<script type="text/worker">on("sheet:opened", eventInfo => {
    getAttrs(["sheet_version"], values => {
        if (values["sheet_version"] !== "1") {
            getAttrs(["song", "iconic", "totalluck"], values => {
                const set_attrs = {};

                set_attrs["favourite_song"] = values["song"];
                set_attrs["iconic_item"] = values["iconic"];
                set_attrs["luck_max"] = values["totalluck"];
                set_attrs["sheet_version"] = 1;

                setAttrs(set_attrs);
            })

        }
    })
});
</script>