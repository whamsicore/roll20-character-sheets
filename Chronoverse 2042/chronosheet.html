<button 
  name="roll_reroll_push" 
  type="roll" 
  value="&amp;{template:chrono} {{name=Push}} {{character_name=@{character_name}}} {{desire=@{desire}}} {{empathy=@{empathy}}} {{roll=[[[[@{desire}]]d6&gt;6]]}} !modattr --silent --charid @{character_id} --energy|[[-1-]]!!! {{energy=[[@{energy}-1]]}} {{energyMax=@{energy|max}}}">
</button>

<button 
  name="roll_desire_push" 
  type="roll" 
  value="&amp;{template:chrono} {{action_name=Desire Push}} {{character_name=@{character_name}}} {{stat_title=Desire}} {{stat_value=@{desire}}} {{skill_title=Fear}} {{skill_value=@{fear}}} {{total_dice=[[@{desire}+@{fear}]]}} {{roll=[[[[@{desire}+@{fear}]]d6&gt;6]]}} !modattr --silent --charid @{character_id} --energy|[[-1-@{fear}]]!!! {{energy=[[@{energy}-1-@{fear}]]}} {{energyMax=@{energy|max}}}">
</button>


<!-- TODO: 
  - Add fear as bonus to desire_push. 
  - Substract additional energy.
  - Add condition for showing desire_push option
  push costs X amt of energy, depending on FEAR and PAIN and the type of push.  -->
<button 
  name="roll_empathy_push" 
  type="roll" 
  value="&amp;{template:chrono} {{name=Empathy Push}} {{character_name=@{character_name}}} {{empathy=@{empathy}}} {{roll=[[[[@{empathy}+@{fear}]]d6&gt;6]]}} !modattr --silent --charid @{character_id} --energy|[[-1-@{fear}]]!!! {{energy=[[@{energy}-1]]}} {{energyMax=@{energy|max}}}">
</button>

<input data-i18n-value="Reroll" name="attr_desire_push_button" type="hidden" value="Desire Push"/>
<input data-i18n-value="Reroll" name="attr_empathy_push_button" type="hidden" value="Empathy Push"/>

<input name="attr_sheet_version" type="hidden"/>

<div class="chrono-wrapper">
  <div class="chrono-logo">
    <img src="https://i.imgur.com/dHQ6x3o.png" />
    <div class="chrono-panel turn-tracker"> 
      <span name="attr_turn_tracker" value="0"></span>
    </div>
  </div>
  <div class="chrono-col1">
    
    <!-- Full Body -->
    <!-- <div class="chrono-panel">
      <div class="chrono-panel__header rand-bg-9 mid-bg dark-txt">
        <span class="chrono-panel__left" xdata-i18n="Skills">Body</span>
        <span class="chrono-panel__right" xdata-i18n="Bonus">Level</span>
      </div>
      <fieldset class="repeating_skill">
        <div class="chrono-panel__row--item chrono-panel__row--skill rand-bg-3">
          <input class="chrono-panel__input--hide" name="attr_body_skill_name" type="text"/>
          <input class="chrono-panel__input--skill" name="attr_body_skill_type" type="number" value="0"/>
          <button type="action"
        </div>
      </fieldset>
    </div> --> <!-- Body -->

    <!-- Skill(CTR) -->
    <div class="chrono-panel">
      <div class="chrono-panel__header rand-bg-9 dark-bg dark-txt">
        <span class="chrono-panel__left" xdata-i18n="Skills">Control</span>
        <span class="chrono-panel__right" xdata-i18n="Bonus">LvL</span>
      </div>
      <fieldset class="repeating_ctrl-skill">
        <div class="chrono-panel__row--skill rand-bg-3">
          <input class="chrono-panel__input--hide" name="attr_ctr-skill-title" type="text" placeholder="CTR Skill"/>
          <button 
            xclass="chrono-panel__label--button" 
            class="chrono-roll-button blank-roll-button" 
            type="roll" 
            value="&amp;{template:chrono} {{action_name=@{ctr-skill-title} Skill}} {{character_name=@{character_name}}} {{total_dice=[[@{control}+?{Bonus Dice|0}+@{ctr-skill-value}]]}} {{roll=[[[[@{control}+?{Bonus Dice|0}+@{ctr-skill-value}]]d6&gt;6]]}} {{desire_push_button=[@{desire_push_button}](~@{character_id}|desire_push)}} {{stat_value=@{control}}} {{stat_title=Control}} {{push_energy_cost=[[@{fear}+1]]}} {{bonus_dice=?{Bonus Dice|0}}} {{energy=@{energy}}} {{energyMax=@{energy|max}}} !modattr --charid @{character_id} --turn_tracker|[[+1]]!!! {{skill_value=@{ctr-skill-value}}} {{skill_title=@{ctr-skill-title}}}">
          </button>
          <input class="chrono-panel__input--skill" name="attr_ctr-skill-value" type="number" value="0" placeholder="0" />
        </div>
      </fieldset>
    </div> <!-- Skill(CTR) -->

    <!-- Skill(FLO) -->
    <div class="chrono-panel">
      <div class="chrono-panel__header rand-bg-9 light-bg dark-txt">
        <span class="chrono-panel__left" xdata-i18n="Skills">Flow</span>
        <span class="chrono-panel__right" xdata-i18n="Bonus">Level</span>
      </div>
      <fieldset class="repeating_flo-skill">
        <div class="chrono-panel__row--skill rand-bg-3">
          <input class="chrono-panel__input--hide" name="attr_flo-skill-title" type="text" placeholder="FLO Skill"/>
          <input class="chrono-panel__input--skill" name="attr_flo-skill-title" type="number" value="0" placeholder="0" />
        </div>
      </fieldset>
    </div> <!-- Skill(FLO) -->

    <div class="chrono-panel--full chrono-character-info full-panel">
      <div class="chrono-panel__row--span2 chrono-panel__row--type rand-bg-3">
        <input class="chrono-panel__input--hide" name="attr_politic" type="text" placeholder="Political Faction" />
        <!-- <select class="chrono-panel__input--hide" name="attr_politic">
          <option value="Futurist" checked>Futurist</option>
          <option value="Humanist">Humanist</option>
        </select> -->
      </div>
      <div class="chrono-panel__row--span2 chrono-panel__row--name rand-bg-10">
        <input class="chrono-panel__input--hide" name="attr_character_problems" type="text" placeholder="Problems" />
      </div>
      <div class="chrono-panel__row--span2 chrono-panel__row--name rand-bg-10">
        <input class="chrono-panel__input--hide" name="attr_character_goals" type="text" placeholder="Goal"/>
      </div>
      <div class="chrono-panel__row--span2 chrono-panel__row--name rand-bg-10">
        <input class="chrono-panel__input--hide" name="attr_character_triggers" type="text" placeholder="Triggers"/>
      </div>
      <div class="chrono-panel__row--span2 chrono-panel__row--name rand-bg-10">
        <input class="chrono-panel__input--hide" name="attr_character_traumas" type="text" placeholder="Traumas"/>
      </div>

    </div> <!-- character-info -->

  </div> <!-- chrono-col1 -->
  
  <div class="chrono-col2">
    <div class="chrono-col21">
      <div class="chrono-panel--alternate">
        <div class="chrono-panel__header rand-bg-2" xdata-i18n="Attributes">Body</div>

        <div class="chrono-panel__row chrono-attr-row rand-bg-6 dark-bg dark-txt">
          <button 
            class="chrono-panel__label--button" 
            xdata-i18n="Control" 
            type="roll" 
            value="&amp;{template:chrono} {{action_name=Control}} {{character_name=@{character_name}}} {{roll=[[[[@{control}+?{Bonus Dice|0}]]d6&gt;6]]}} {{desire_push_button=[@{desire_push_button}](~@{character_id}|reroll_push)}} {{stat_value=@{control}}} {{stat_title=Control}} {{bonus_dice=?{Bonus Dice|0}}} {{energy=@{energy}}} {{energyMax=@{energy|max}}}"> Control
          </button>
          <input class="chrono-panel__input--small" name="attr_control" type="number" value="0"/>
        </div> <!-- control button -->

        <div class="chrono-panel__row chrono-attr-row rand-bg-6 light-bg dark-txt">
          <button 
            class="chrono-panel__label--button" 
            xdata-i18n="Flow" 
            type="roll" 
            value="&amp;{template:chrono} {{action_name=Flow}} {{character_name=@{character_name}}} {{roll=[[[[@{flow}+?{Bonus Dice|0}]]d6&gt;6]]}} {{stat_value=@{flow}}} {{stat_title=flow}} {{bonus_dice=?{Bonus Dice|0}}} "> Flow
          </button>
          <input class="chrono-panel__input--small" name="attr_flow" type="number" value="0"/>
        </div> <!-- flow button -->
      </div> <!-- Body attributes -->

      <div class="chrono-panel--alternate">
        <div class="chrono-panel__header rand-bg-2" xdata-i18n="Hitpoints">Hitpoint</div>

        <div class="chrono-panel__row chrono-resource-row rand-bg-6">
          <img class="heart-symbol" src="https://i.imgur.com/yxSrvMU.png"/>
          <input class="chrono-panel__input--small" name="attr_hitpoint" xplaceholder="25" title="@{attr_hitpoint}" type="number">
          <span class="minmax-display-divide"> / </span>
          <input class="chrono-panel__input--small" name="attr_hitpoint_max" xplaceholder="25" title="@{attr_hitpoint_max}" type="number">
        </div>
      </div> <!-- sheet-hitpoint-display -->

      <!-- pain display  -->
      <div class="chrono-panel--alternate">
        <div class="chrono-panel__header rand-bg-2" xdata-i18n="Suffering">Pain</div>
        <div class="chrono-panel__row rand-bg-1 light-bg dark-txt"> 
          <input class="chrono-panel__input--small" name="attr_pain" xplaceholder="25" title="@{attr_pain}" type="number" placeholder="0">
          <span class="minmax-display-divide"> / </span>
          <input type="number" name="attr_pain_tolerance" disabled="true" value="@{desire}" />
        </div>
      </div> <!-- pain display  -->

    </div> <!-- chrono-col21 -->

    <div class="chrono-col22">
      <div class="chrono-panel--full">
        <div class="chrono-panel__row--span2 chrono-panel__row--name rand-bg-10">
          <input class="chrono-panel__input--hide centered-text" name="attr_character_name" type="text" placeholder="Your Name"/>
        </div>
        <img class="chrono-meditation-man" src="https://i.imgur.com/h1ZilOT.png"/> <!-- ICON: meditating man -->
      </div>

      <!-- Spirit attributes -->
      <div class="chrono-panel--full chrono-panel--alternate">
        <div class="chrono-panel__header rand-bg-2" xdata-i18n="Attributes">Spirit</div>

        <div class="chrono-panel__row chrono-attr-row rand-bg-6 dark-bg dark-txt">
          <button 
            class="chrono-panel__label--button" 
            xdata-i18n="Desire" 
            type="roll" 
            value="&amp;{template:chrono} {{action_name=Desire}} {{character_name=@{character_name}}} {{roll=[[[[@{desire}+?{Bonus Dice|0}]]d6&gt;6]]}} {{stat_value=@{desire}}} {{stat_title=desire}} {{bonus_dice=?{Bonus Dice|0}}} "> Desire
          </button>
          <input class="chrono-panel__input--small" name="attr_desire" type="number" value="0"/>
        </div> <!-- desire button -->

        <div class="chrono-panel__row chrono-attr-row rand-bg-6 light-bg dark-txt">
          <button 
            class="chrono-panel__label--button" 
            xdata-i18n="Empathy" 
            type="roll" 
            value="&amp;{template:chrono} {{name=empathy}} {{character_name=@{character_name}}} {{roll=[[[[@{empathy}+?{Bonus Dice|0}]]d6&gt;6]]}} {{stat_value=@{empathy}}} {{stat_title=empathy}} {{bonus_dice=?{Bonus Dice|0}}} "> Empathy
          </button>
          <input class="chrono-panel__input--small" name="attr_empathy" type="number" value="0"/>
        </div> <!-- empathy button -->
      </div> <!-- Spirit attributes -->

    </div> <!-- chrono-col22 -->

    <div class="chrono-col23">
      <div class="chrono-panel--alternate">
        <div class="chrono-panel__header rand-bg-2" xdata-i18n="Attributes">Mind</div>

        <div class="chrono-panel__row chrono-attr-row rand-bg-6 dark-bg dark-txt">
          <button 
            class="chrono-panel__label--button" 
            xdata-i18n="Logic" 
            type="roll" 
            value="&amp;{template:chrono} {{action_name=Logic}} {{character_name=@{character_name}}} {{roll=[[[[@{logic}+?{Bonus Dice|0}]]d6&gt;6]]}} {{stat_value=@{logic}}} {{stat_title=Logic}} {{bonus_dice=?{Bonus Dice|0}}} "> Logic
          </button>
          <input class="chrono-panel__input--small" name="attr_logic" type="number" value="0"/>
        </div> <!-- Logic button -->
        
        <div class="chrono-panel__row chrono-attr-row rand-bg-6 light-bg dark-txt">
          <button 
            class="chrono-panel__label--button" 
            xdata-i18n="Vibe" 
            type="roll" 
            value="&amp;{template:chrono} {{action_name=Vibe}} {{character_name=@{character_name}}} {{roll=[[[[@{vibe}+?{Bonus Dice|0}]]d6&gt;6]]}} {{stat_value=@{vibe}}} {{stat_title=Vibe}} {{bonus_dice=?{Bonus Dice|0}}} "> Vibe
          </button>
          <input class="chrono-panel__input--small" name="attr_vibe" type="number" value="0"/>
        </div> <!-- Vibe button -->
      </div> <!-- Mind Attributes -->

      <div class="chrono-panel--alternate">
        <div class="chrono-panel__header rand-bg-2" xdata-i18n="Hitpoints">Energy </div>

        <div class="chrono-panel__row chrono-resource-row rand-bg-9">
          <img class="lightning-symbol" src="https://i.imgur.com/gpv6fx1.png"/>
          <input class="chrono-panel__input--small" name="attr_energy" xplaceholder="25" title="@{attr_energy}" type="number">
          <span class="minmax-display-divide">/  </span>
          <input class="chrono-panel__input--small" name="attr_energy_max" xplaceholder="25" title="@{attr_energy_max}" type="number">
        </div>
      </div> <!-- sheet-energy-display -->

      <!-- fear display -->
      <div class="chrono-panel--alternate">
        <div class="chrono-panel__header rand-bg-9" xdata-i18n="Suffering">Fear</div>
        <div class="chrono-panel__row rand-bg-1 dark-bg dark-txt"> 
          <input class="chrono-panel__input--small" name="attr_fear" xplaceholder="25" title="@{attr_fear}" type="number" placeholder="0">
          <span class="minmax-display-divide"> / </span>
          <input type="number" name="attr_fear_tolerance" disabled="true" value="@{empathy}"/>
        </div>
      </div> <!-- fear display  -->
    </div> <!-- chrono-col23 -->

    <!-- chrono-items -->
    <div class="chrono-panel chrono-panel--full">
      <div class="chrono-panel__header rand-bg-9">
        <span class="chrono-panel__left" xdata-i18n="Items">Items</span>
        <span class="chrono-panel__right" xdata-i18n="Bonus">Qty</span>
      </div>
      <!-- <div class="chrono-panel__row--iconic rand-bg-6">
        <span class="chrono-panel__label--small" data-i18n="Iconic Item">Iconic Item</span>
        <input class="chrono-panel__input--hide" name="attr_iconic_item" type="text"/>
        <span class="chrono-panel__label--value">+2</span>
      </div> -->
      <fieldset class="repeating_item">
        <div class="chrono-panel__row--item rand-bg-3">
          <input class="chrono-panel__input--hide" name="attr_item_name" type="text"/>
          <!-- <span class="chrono-panel__label--plus">+</span> -->
          <input class="chrono-panel__input--item" name="attr_item_bonus" type="number" value="0"/>
        </div>
      </fieldset>
    </div> <!-- chrono-items -->

    <!-- chrono-relationships -->
    <div class="chrono-panel chrono-panel--full">
      <div class="chrono-panel__header rand-bg-5" xdata-i18n="Relationships">
        <span class="chrono-panel__left" xdata-i18n="Items">Relationships</span>
        <span class="chrono-panel__right" xdata-i18n="Bonus">Connection</span>
      </div>
      <fieldset class="repeating_relationships">
        <div class="chrono-panel__row--item chrono-panel__row--relationship rand-bg-5">
          <select class="chrono-panel__label--select" name="attr_relationship_type">
            <option data-i18n="PC">PC</option>
            <option data-i18n="NPC">NPC</option>
          </select>
          <input class="chrono-panel__input--hide" name="attr_relationship" type="text"/>
          <input class="chrono-panel__input--item" name="attr_relationship_connection" type="number" value="0"/>
        </div>
      </fieldset>
    </div> <!-- chrono-relationships -->
  </div> <!-- chrono-col2 -->

  <div class="chrono-col3">
    <!-- Full MIND -->
    <!-- <div class="chrono-panel">
      <div class="chrono-panel__header rand-bg-9 mid-bg dark-txt">
        <span class="chrono-panel__left" xdata-i18n="Skills">Mind</span>
        <span class="chrono-panel__right" xdata-i18n="Bonus">Level</span>
      </div>
      <fieldset class="repeating_skill">
        <div class="chrono-panel__row--skill rand-bg-3">
          <input class="chrono-panel__input--hide" name="attr_mind_skill_name" type="text"/>
          <input class="chrono-panel__input--skill" name="attr_mind_skill_type" type="number" value="0"/>
        </div>
      </fieldset>
    </div> --> <!-- Full MIND -->

    <!-- Skill(LOG) -->
    <div class="chrono-panel">
      <div class="chrono-panel__header rand-bg-9 dark-bg dark-txt">
        <span class="chrono-panel__left" xdata-i18n="Skills">Logic</span>
        <span class="chrono-panel__right" xdata-i18n="Bonus">Level</span>
      </div>
      <fieldset class="repeating_log-skill">
        <div class="chrono-panel__row--skill rand-bg-3">
          <input class="chrono-panel__input--hide" name="attr_log-skill-title" type="text" placeholder="LOG Skill"/>
          <input class="chrono-panel__input--skill" name="attr_log-skill-title" type="number" value="0" placeholder="0" />
        </div>
      </fieldset>
    </div> <!-- Skill(LOG) -->

    <!-- Skill(VIB) -->
    <div class="chrono-panel">
      <div class="chrono-panel__header rand-bg-9 light-bg dark-txt">
        <span class="chrono-panel__left" xdata-i18n="Skills">Vibe</span>
        <span class="chrono-panel__right" xdata-i18n="Bonus">Level</span>
      </div>
      <fieldset class="repeating_vib-skill">
        <div class="chrono-panel__row--skill rand-bg-3">
          <input class="chrono-panel__input--hide" name="attr_vib-skill-title" type="text" placeholder="VIB Skill"/>
          <input class="chrono-panel__input--skill" name="attr_vib-skill-title" type="number" value="0" placeholder="0" />
        </div>
      </fieldset>
    </div> <!-- Skill(VIB) -->

    <div class="chrono-panel--alternate">
      <div class="chrono-panel__header rand-bg-2" xdata-i18n="Character Level">Level</div>

      <div class="chrono-panel__row rand-bg-6">
        <input type="number" name="attr_character_level" value="@{control}*2+@{flow}*2+@{logic}*2+@{vibe}*2+@{desire}*5+@{empathy}*5" disabled="true" />
      </div>
    </div> <!-- sheet-level-display -->

    <div class="chrono-panel--alternate">
      <div class="chrono-panel__header rand-bg-2" xdata-i18n="Level">Experience</div>

      <div class="chrono-panel__row rand-bg-6">
        <input type="number" name="attr_character_exp"/>
      </div>
    </div> <!-- sheet-exp-display -->

  </div> <!-- chrono-col3 -->
  
</div> <!-- chrono-wrapper -->

<rolltemplate class="sheet-rolltemplate-chrono">
  <div class="sheet-chrono-container">
    {{#action_name}}
      <h1>{{action_name}}</h1>
    {{/action_name}}

    {{#character_name}}
      <h2>{{character_name}} </h2>
    {{/character_name}}

    <div class="sheet-chrono-body">
      {{#stat_value}}
        <div class="sheet-chrono-roll-row">
          <span>{{stat_title}}</span><span>(+{{stat_value}})</span>
        </div>
      {{/stat_value}}
      
      {{#skill_value}}
        <div class="sheet-chrono-roll-row">
          <span>{{skill_title}}</span><span>(+{{skill_value}})</span></div>
      {{/skill_value}}

      {{#bonus_dice}}
        <div class="sheet-chrono-roll-row">
          <span data-i18n="Bonus">Bonus</span><span>(+{{bonus_dice}}) </span>
        </div>
      {{/bonus_dice}}

      <div class="sheet-chrono-roll-row">
        <span xdata-i18n="Bonus">Energy</span>
        <span>({{energy}}) </span> / <span>({{energyMax}}) </span> 
      </div>
      
    </div>
    <div class="sheet-chrono-roll">
      <span>{{roll}}/{{total_dice}}</span> <span>Successes</span>
    </div>

    <div class="sheet-chrono-buttons">
      {{#desire_push_button}}
        {{desire_push_button}}
        <div class="sheet-chrono-buttontext" 
          xdata-i18n="">
          Use {{push_energy_cost}} energy to push
        </div>
      {{/desire_push_button}}

    </div>

    <div class="sheet-chrono-footer"></div>

  </div> <!-- sheet-chrono-container -->
</rolltemplate>

<script type="text/worker">
  on("sheet:opened", eventInfo => {
    getAttrs(["sheet_version"], values => {
      if (values["sheet_version"] !== "1") {
        getAttrs(["song", "iconic", "totalluck"], values => {
          const set_attrs = {};

          set_attrs["favourite_song"] = values["song"];
          set_attrs["iconic_item"] = values["iconic"];
          set_attrs["luck_max"] = values["totalluck"];
          set_attrs["sheet_version"] = 1;

          setAttrs(set_attrs);
        })

      }
    })
  });

  on('clicked:add', function() {
    // console.log("payton was here");

    getAttrs(['level'], function(values) {
        // get the level stat, and coerce into a numerical value.
        const level = +values.level || 0; 
        // increase by 1
        const newlevel = level +1;
        // save the updated attribute to the sheet
        setAttrs({
           level: newlevel 
        });
   });
  });
</script>